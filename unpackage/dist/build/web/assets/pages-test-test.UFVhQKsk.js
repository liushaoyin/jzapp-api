import{D as s,c as t,w as e,i as a,o as l,d as i,e as d,t as o,u,g as n,r,F as g,f as c,k as h,j as f}from"./index-CoNwD4i1.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const m=_({data:()=>({testing:{network:!1,cloud:!1,database:!1,all:!1},results:{network:null,cloud:null,database:null},errorLog:[],suggestions:[]}),onLoad(){this.addLog("页面加载完成，开始诊断测试")},methods:{async testBasicNetwork(){this.testing.network=!0,this.addLog("开始测试基础网络连接...");try{const s=await fetch("https://httpbin.org/get",{method:"GET",timeout:5e3});s.ok?(this.results.network=!0,this.addLog("✓ 基础网络连接正常")):(this.results.network=!1,this.addLog("✗ 基础网络连接失败: HTTP "+s.status))}catch(s){this.results.network=!1,this.addLog("✗ 基础网络连接失败: "+s.message),this.addSuggestion("检查网络连接，如果在国外可能需要使用VPN")}finally{this.testing.network=!1}},async testCloudFunction(){this.testing.cloud=!0,this.addLog("开始测试云函数连接...");try{const t=await s.callFunction({name:"getBills",data:{limit:1}});t&&t.result?(this.results.cloud=!0,this.addLog("✓ 云函数连接正常")):(this.results.cloud=!1,this.addLog("✗ 云函数连接失败: 返回结果异常"))}catch(t){this.results.cloud=!1,this.addLog("✗ 云函数连接失败: "+t.message),this.addSuggestion("检查云函数是否已正确部署"),this.addSuggestion("检查云空间配置是否正确")}finally{this.testing.cloud=!1}},async testDatabase(){var t;this.testing.database=!0,this.addLog("开始测试数据库连接...");try{const e=await s.callFunction({name:"testConnection"});e.result&&200===e.result.code?(this.results.database=!0,this.addLog("✓ 数据库连接正常"),this.addLog(`可用集合: ${e.result.data.collections.join(", ")}`),this.addLog(`账单数量: ${e.result.data.billsCount}`),this.addLog(`成员数量: ${e.result.data.membersCount}`)):(this.results.database=!1,this.addLog("✗ 数据库连接失败: "+((null==(t=e.result)?void 0:t.message)||"未知错误")))}catch(e){this.results.database=!1,this.addLog("✗ 数据库连接失败: "+e.message),this.addSuggestion("检查数据库集合是否存在"),this.addSuggestion("检查数据库权限配置")}finally{this.testing.database=!1}},async runAllTests(){this.testing.all=!0,this.addLog("开始运行完整测试..."),this.suggestions=[],await this.testBasicNetwork(),this.results.network&&(await this.testCloudFunction(),this.results.cloud&&await this.testDatabase()),this.generateSuggestions(),this.testing.all=!1,this.addLog("完整测试完成")},generateSuggestions(){this.results.network||(this.addSuggestion("网络连接失败，请检查网络设置"),this.addSuggestion("如果在国外，建议使用VPN或代理")),this.results.network&&!this.results.cloud&&(this.addSuggestion("网络正常但云函数连接失败，请检查云函数部署状态"),this.addSuggestion("在HBuilderX中重新部署云函数")),this.results.cloud&&!this.results.database&&(this.addSuggestion("云函数正常但数据库连接失败，请检查数据库配置"),this.addSuggestion("检查数据库集合是否已创建")),this.results.network&&this.results.cloud&&this.results.database&&this.addSuggestion("所有测试通过！系统运行正常")},addLog(s){const t=(new Date).toLocaleTimeString();this.errorLog.unshift({time:t,message:s}),this.errorLog.length>20&&(this.errorLog=this.errorLog.slice(0,20))},addSuggestion(s){this.suggestions.includes(s)||this.suggestions.push(s)}}},[["render",function(s,_,m,b,k,L){const w=h,S=a,y=f;return l(),t(S,{class:"test-page"},{default:e((()=>[i(S,{class:"test-header"},{default:e((()=>[i(w,{class:"test-title"},{default:e((()=>[d("系统诊断测试")])),_:1}),i(w,{class:"test-subtitle"},{default:e((()=>[d("检测网络连接和云服务状态")])),_:1})])),_:1}),i(S,{class:"test-section"},{default:e((()=>[i(S,{class:"section-title"},{default:e((()=>[d("基础网络测试")])),_:1}),i(S,{class:"test-item"},{default:e((()=>[i(w,{class:"test-name"},{default:e((()=>[d("网络连接")])),_:1}),i(y,{onClick:L.testBasicNetwork,disabled:k.testing.network,class:"test-btn"},{default:e((()=>[d(o(k.testing.network?"测试中...":"测试"),1)])),_:1},8,["onClick","disabled"]),i(w,{class:u(["test-result",k.results.network?"success":"error"])},{default:e((()=>[d(o(k.results.network?"✓ 正常":!1===k.results.network?"✗ 失败":"未测试"),1)])),_:1},8,["class"])])),_:1})])),_:1}),i(S,{class:"test-section"},{default:e((()=>[i(S,{class:"section-title"},{default:e((()=>[d("云函数测试")])),_:1}),i(S,{class:"test-item"},{default:e((()=>[i(w,{class:"test-name"},{default:e((()=>[d("云函数连接")])),_:1}),i(y,{onClick:L.testCloudFunction,disabled:k.testing.cloud,class:"test-btn"},{default:e((()=>[d(o(k.testing.cloud?"测试中...":"测试"),1)])),_:1},8,["onClick","disabled"]),i(w,{class:u(["test-result",k.results.cloud?"success":"error"])},{default:e((()=>[d(o(k.results.cloud?"✓ 正常":!1===k.results.cloud?"✗ 失败":"未测试"),1)])),_:1},8,["class"])])),_:1})])),_:1}),i(S,{class:"test-section"},{default:e((()=>[i(S,{class:"section-title"},{default:e((()=>[d("数据库测试")])),_:1}),i(S,{class:"test-item"},{default:e((()=>[i(w,{class:"test-name"},{default:e((()=>[d("数据库连接")])),_:1}),i(y,{onClick:L.testDatabase,disabled:k.testing.database,class:"test-btn"},{default:e((()=>[d(o(k.testing.database?"测试中...":"测试"),1)])),_:1},8,["onClick","disabled"]),i(w,{class:u(["test-result",k.results.database?"success":"error"])},{default:e((()=>[d(o(k.results.database?"✓ 正常":!1===k.results.database?"✗ 失败":"未测试"),1)])),_:1},8,["class"])])),_:1})])),_:1}),i(S,{class:"test-section"},{default:e((()=>[i(S,{class:"section-title"},{default:e((()=>[d("完整测试")])),_:1}),i(S,{class:"test-item"},{default:e((()=>[i(w,{class:"test-name"},{default:e((()=>[d("一键测试所有")])),_:1}),i(y,{onClick:L.runAllTests,disabled:k.testing.all,class:"test-btn primary"},{default:e((()=>[d(o(k.testing.all?"测试中...":"开始测试"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),k.errorLog.length>0?(l(),t(S,{key:0,class:"error-log"},{default:e((()=>[i(S,{class:"log-title"},{default:e((()=>[d("错误日志")])),_:1}),(l(!0),n(g,null,r(k.errorLog,((s,a)=>(l(),t(S,{key:a,class:"log-item"},{default:e((()=>[i(w,{class:"log-time"},{default:e((()=>[d(o(s.time),1)])),_:2},1024),i(w,{class:"log-message"},{default:e((()=>[d(o(s.message),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):c("",!0),k.suggestions.length>0?(l(),t(S,{key:1,class:"suggestions"},{default:e((()=>[i(S,{class:"suggestions-title"},{default:e((()=>[d("解决建议")])),_:1}),(l(!0),n(g,null,r(k.suggestions,((s,a)=>(l(),t(S,{key:a,class:"suggestion-item"},{default:e((()=>[i(w,{class:"suggestion-text"},{default:e((()=>[d(o(s),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):c("",!0)])),_:1})}],["__scopeId","data-v-4a25519f"]]);export{m as default};
