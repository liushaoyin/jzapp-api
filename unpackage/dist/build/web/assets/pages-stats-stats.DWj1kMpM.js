import{b as e,a as t,h as a,c as s,w as l,i as o,o as c,d as n,g as r,r as i,F as u,e as d,t as g,u as m,k as f,x as p}from"./index-CoNwD4i1.js";import{a as _}from"./api.D7tYKUGc.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=h({data:()=>({currentTimeRange:"month",timeTabs:[{label:"本周",value:"week"},{label:"本月",value:"month"},{label:"本年",value:"year"}],totalExpense:"0.00",totalIncome:"0.00",netIncome:"0.00",expenseCategories:[],incomeCategories:[]}),onLoad(){this.loadStats()},methods:{selectTimeRange(e){this.currentTimeRange=e,this.loadStats()},async loadStats(){try{e({title:"加载中..."});const{startDate:t,endDate:s}=this.getDateRange(),l=await _.getBills({startDate:t.toISOString(),endDate:s.toISOString(),type:"expense"}),o=await _.getBills({startDate:t.toISOString(),endDate:s.toISOString(),type:"income"});200===l.code&&this.processExpenseData(l.data.list),200===o.code&&this.processIncomeData(o.data.list)}catch(s){console.error("加载统计数据失败:",s),t({title:"加载失败",icon:"none"})}finally{a()}},getDateRange(){const e=new Date;let t,a;switch(this.currentTimeRange){case"week":const s=new Date(e);s.setDate(e.getDate()-e.getDay()),s.setHours(0,0,0,0),t=s,a=new Date(s),a.setDate(s.getDate()+6),a.setHours(23,59,59,999);break;case"month":default:t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0),a.setHours(23,59,59,999);break;case"year":t=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear(),11,31),a.setHours(23,59,59,999)}return{startDate:t,endDate:a}},processExpenseData(e){const t={};let a=0;e.forEach((e=>{const s=e.category||"其他";t[s]||(t[s]=0),t[s]+=e.amount,a+=e.amount})),this.totalExpense=a.toFixed(2),this.expenseCategories=Object.keys(t).map((e=>({name:e,amount:t[e].toFixed(2),percentage:a>0?Math.round(t[e]/a*100):0}))).sort(((e,t)=>parseFloat(t.amount)-parseFloat(e.amount)))},processIncomeData(e){const t={};let a=0;e.forEach((e=>{const s=e.category||"其他";t[s]||(t[s]=0),t[s]+=e.amount,a+=e.amount})),this.totalIncome=a.toFixed(2);const s=a-parseFloat(this.totalExpense);this.netIncome=s.toFixed(2),this.incomeCategories=Object.keys(t).map((e=>({name:e,amount:t[e].toFixed(2),percentage:a>0?Math.round(t[e]/a*100):0}))).sort(((e,t)=>parseFloat(t.amount)-parseFloat(e.amount)))}}},[["render",function(e,t,a,_,h,y){const v=o,D=f;return c(),s(v,{class:"container"},{default:l((()=>[n(v,{class:"filter-section"},{default:l((()=>[n(v,{class:"filter-tabs"},{default:l((()=>[(c(!0),r(u,null,i(h.timeTabs,(e=>(c(),s(v,{key:e.value,class:m(["filter-tab",{active:h.currentTimeRange===e.value}]),onClick:t=>y.selectTimeRange(e.value)},{default:l((()=>[d(g(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),n(v,{class:"overview-cards"},{default:l((()=>[n(v,{class:"overview-card"},{default:l((()=>[n(D,{class:"overview-label"},{default:l((()=>[d("总支出")])),_:1}),n(D,{class:"overview-value expense"},{default:l((()=>[d("¥"+g(h.totalExpense),1)])),_:1})])),_:1}),n(v,{class:"overview-card"},{default:l((()=>[n(D,{class:"overview-label"},{default:l((()=>[d("总收入")])),_:1}),n(D,{class:"overview-value income"},{default:l((()=>[d("¥"+g(h.totalIncome),1)])),_:1})])),_:1}),n(v,{class:"overview-card"},{default:l((()=>[n(D,{class:"overview-label"},{default:l((()=>[d("净收入")])),_:1}),n(D,{class:m(["overview-value",h.netIncome>=0?"income":"expense"])},{default:l((()=>[d(" ¥"+g(h.netIncome),1)])),_:1},8,["class"])])),_:1})])),_:1}),n(v,{class:"stats-section"},{default:l((()=>[n(v,{class:"section-header"},{default:l((()=>[n(D,{class:"section-title"},{default:l((()=>[d("支出分类")])),_:1})])),_:1}),n(v,{class:"category-list"},{default:l((()=>[(c(!0),r(u,null,i(h.expenseCategories,(e=>(c(),s(v,{key:e.name,class:"category-item"},{default:l((()=>[n(v,{class:"category-info"},{default:l((()=>[n(D,{class:"category-name"},{default:l((()=>[d(g(e.name),1)])),_:2},1024),n(D,{class:"category-amount"},{default:l((()=>[d("¥"+g(e.amount),1)])),_:2},1024)])),_:2},1024),n(v,{class:"category-bar"},{default:l((()=>[n(v,{class:"category-progress",style:p({width:e.percentage+"%"})},null,8,["style"])])),_:2},1024),n(D,{class:"category-percentage"},{default:l((()=>[d(g(e.percentage)+"%",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),n(v,{class:"stats-section"},{default:l((()=>[n(v,{class:"section-header"},{default:l((()=>[n(D,{class:"section-title"},{default:l((()=>[d("收入分类")])),_:1})])),_:1}),n(v,{class:"category-list"},{default:l((()=>[(c(!0),r(u,null,i(h.incomeCategories,(e=>(c(),s(v,{key:e.name,class:"category-item"},{default:l((()=>[n(v,{class:"category-info"},{default:l((()=>[n(D,{class:"category-name"},{default:l((()=>[d(g(e.name),1)])),_:2},1024),n(D,{class:"category-amount"},{default:l((()=>[d("¥"+g(e.amount),1)])),_:2},1024)])),_:2},1024),n(v,{class:"category-bar"},{default:l((()=>[n(v,{class:"category-progress income",style:p({width:e.percentage+"%"})},null,8,["style"])])),_:2},1024),n(D,{class:"category-percentage"},{default:l((()=>[d(g(e.percentage)+"%",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),n(v,{class:"stats-section"},{default:l((()=>[n(v,{class:"section-header"},{default:l((()=>[n(D,{class:"section-title"},{default:l((()=>[d("收支趋势")])),_:1})])),_:1}),n(v,{class:"trend-chart"},{default:l((()=>[n(v,{class:"chart-placeholder"},{default:l((()=>[n(D,{class:"chart-text"},{default:l((()=>[d("图表功能开发中...")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-72858d97"]]);export{y as default};
